FROM python:3.11-slim-bookworm

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy alembic config (migrations and source are volume-mounted for hot reload)
COPY alembic.ini .

# Source code, alembic/, and seed scripts are volume-mounted for hot reload
# Only copy what's needed for initial startup if volumes aren't ready

EXPOSE 8000

# Development mode with hot reload
# --reload-dir ensures uvicorn watches the mounted /app/src directory
CMD ["uvicorn", "src.main:app", "--host", "0.0.0.0", "--port", "8000", "--reload", "--reload-dir", "/app/src"]
